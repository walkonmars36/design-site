<section id="about-me">
  <div class="about flow wrapper">
    <div class="about__content">
      <div class="flow">
        <h2>About Me</h2>
        <p class="huge-5">
          I haven’t taken the typical route to becoming a freelance web
          designer.
        </p>
        <p>
          My background in music, screen printing, and running a creative
          business has shaped my approach to design and collaboration.
        </p>
        <p>
          I first explored web design while running a sustainable printing
          business, creating websites to promote local artists and their work.
        </p>
      </div>

      <details class="about-disclosure">
        <summary class="btn">Read more</summary>

        <div class="more-text flow">
          <p>
            This experience gave me a strong eye for detail, colour, and design,
            along with a deep understanding of working closely with clients to
            bring their visions to life.
          </p>
          <p>
            Today, I focus on frontend development, user experience, and
            accessibility, while drawing on technical knowledge from backend
            development and software engineering training.
          </p>
          <p>
            Alongside web design, I run an online t-shirt design business, which
            keeps me connected to creative industries and sharpens my skills in
            ecommerce and branding.
          </p>
          <p>
            I believe in building websites that reflect your goals and values,
            whether you're an individual, small business, or nonprofit.
          </p>
          <p>
            Based in Bristol, UK, I’ll work with you to create a site that’s
            tailored to your needs and budget, with a collaborative approach
            that makes you feel like we’re part of the same team.
          </p>
          <button type="button" class="btn details-close">Show less</button>
        </div>
      </details>
    </div>
  </div>
</section>

<style>
  /* --- About section base --- */
  section {
    margin-top: var(--space-l);
  }
  .about {
    margin-inline: auto;
    background: var(--color-bg-light);
  }
  .about__content {
    max-width: 65rem;
    margin-inline: auto;
  }
  .huge-5 {
    line-height: 1.2;
    max-width: 23ch;
  }

  /* --- Summary “Read more” button (top opener) --- */
  summary.btn {
    color: var(--color-accent-500);
    cursor: pointer;
    list-style: none; /* Firefox default marker */
    user-select: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }
  summary.btn::-webkit-details-marker {
    display: none;
  } /* Chrome/Safari marker */
  summary.btn::marker {
    content: "";
  } /* Firefox marker reset */
  summary.btn:focus-visible {
    outline: 2px solid var(--color-accent-300);
    outline-offset: 2px;
  }

  /* --- Open/close visibility (Safari-safe) --- */
  /* Hide the top summary when open; show the bottom close button */
  details.about-disclosure[open] > summary.btn {
    display: none;
  }
  .details-close {
    display: none;
  }
  details.about-disclosure[open] .details-close {
    display: inline-flex;
  }

  /* Optional: if your summary contains label spans, this swaps them */
  .label-less {
    display: none;
  }
  details.about-disclosure[open] .label-more {
    display: none;
  }
  details.about-disclosure[open] .label-less {
    display: inline;
  }

  /* --- Collapsible panel --- */
  /* JS will animate height; just ensure we can clip. */
  details.about-disclosure .more-text {
    margin-top: 1em;
    overflow: hidden;
  }
</style>

<script is:inline>
  // Smooth open/close for ALL <details class="about-disclosure"> blocks on the page
  function bindDisclosures() {
    const reduce = matchMedia("(prefers-reduced-motion: reduce)").matches;

    document.querySelectorAll("details.about-disclosure").forEach((det) => {
      if (det.dataset.bound) return;
      det.dataset.bound = "1";

      const summary = det.querySelector("summary");
      const panel = det.querySelector(".more-text");
      const closeBtn = det.querySelector(".details-close");
      if (!summary || !panel) return;

      panel.style.overflow = panel.style.overflow || "hidden";

      const openAnim = () => {
        det.setAttribute("open", ""); // set open state first
        if (reduce) return;
        panel.style.height = "0px";
        const end = panel.scrollHeight;
        requestAnimationFrame(() => {
          panel.style.transition = "height 350ms ease";
          panel.style.height = end + "px";
        });
        panel.addEventListener(
          "transitionend",
          () => {
            panel.style.height = "";
            panel.style.transition = "";
          },
          { once: true }
        );
      };

      const closeAnim = () => {
        if (reduce) {
          det.removeAttribute("open");
          return;
        }
        const start = panel.scrollHeight;
        panel.style.height = start + "px";
        requestAnimationFrame(() => {
          panel.style.transition = "height 300ms ease";
          panel.style.height = "0px";
        });
        panel.addEventListener(
          "transitionend",
          () => {
            panel.style.height = "";
            panel.style.transition = "";
            det.removeAttribute("open");
          },
          { once: true }
        );
      };

      // Open from the top summary (prevent native toggle to avoid loops)
      summary.addEventListener("click", (e) => {
        e.preventDefault();
        if (!det.hasAttribute("open")) openAnim();
      });

      // Close from the bottom button
      if (closeBtn) {
        closeBtn.addEventListener("click", (e) => {
          e.preventDefault();
          if (det.hasAttribute("open")) closeAnim();
        });
      }
    });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", bindDisclosures, {
      once: true,
    });
  } else {
    bindDisclosures();
  }
  document.addEventListener("astro:page-load", bindDisclosures);
  window.addEventListener("pageshow", bindDisclosures);
</script>
