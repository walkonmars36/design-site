<form
  id="contact-form"
  name="contact"
  action="/form-success"
  method="post"
  data-netlify="true"
  netlify-honeypot="bot-field"
  novalidate
>
  <input type="hidden" name="form-name" value="contact" />

  <fieldset>
    <label for="firstName">First name</label>
    <input
      type="text"
      name="firstName"
      id="firstName"
      autocomplete="given-name"
      placeholder=" "
      required
      pattern=".*\S.*"
    />
    <span class="error-text font-xs-step-2">First name is required</span>
  </fieldset>

  <fieldset>
    <label for="lastName">Last name</label>
    <input
      type="text"
      name="lastName"
      id="lastName"
      autocomplete="family-name"
      placeholder=" "
      required
      pattern=".*\S.*"
    />
    <span class="error-text font-xs-step-2">Last name is required</span>
  </fieldset>

  <fieldset>
    <label for="email">Email</label>
    <input
      type="email"
      name="email"
      id="email"
      autocomplete="email"
      placeholder=" "
      required
      pattern="^[^\s@]+@[^\s@]+\.[^\s@]{2,}$"
    />
    <span class="error-text font-xs-step-2">Email is not valid</span>
  </fieldset>

  <fieldset>
    <label for="message">Message</label>
    <textarea
      name="message"
      id="message"
      rows="5"
      placeholder=" "
      required
      minlength="5"></textarea>
    <span class="error-text font-xs-step-2">Message is required</span>
  </fieldset>

  <button class="submit btn" type="submit">Send</button>
</form>

<style lang="scss">
  /* base */
  .error-text {
    display: none;
    color: var(--clr-error);
    text-align: end;
  }
  form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  label {
    color: var(--color-white);
  }
  input,
  textarea {
    width: 100%;
    padding: 0.25em 0.5em;
    color: inherit;
    background: var(--input-background);
    border: none;
    border-radius: var(--border-radius-sm);
    border-bottom: 2px solid var(--input-grey);
    outline: transparent;
  }
  input:not(textarea) {
    line-height: 1;
    height: 2.25rem;
  }
  textarea {
    margin-top: var(--space-2xs);
    resize: vertical;
    overflow: auto;
  }
  input:focus,
  textarea:focus {
    background: var(--input-focus);
    color: var(--color-primary);
  }

  /* show styles ONLY AFTER first failed submit */
  form.was-validated :invalid {
    border: 2px solid var(--clr-error);
  }
  form.was-validated :invalid ~ .error-text {
    display: block;
  }

  /* optional success styling after first failed submit */
  form.was-validated :valid {
    border: 2px solid var(--color-accent-300);
  }

  /* button */
  .submit.btn {
    align-self: flex-start;
    font-weight: 700;
    background: var(--color-accent-400);
    padding: 0.5em 1.75em;
    border-radius: var(--border-radius-sm);
    margin-top: var(--space-m-l);
    transition:
      background 0.2s ease-in-out,
      transform 0.2s ease-in-out;
  }
  .submit.btn:hover {
    background: var(--color-accent-300);
    transform: scale(1.03);
  }
</style>

<script>
  // @ts-nocheck
  const form = document.getElementById("contact-form");
  const message = document.getElementById("message");

  // disallow whitespace-only message
  const updateMessageValidity = () => {
    if (!message) return;
    const emptyOrSpaces = !message.value || message.value.trim() === "";
    message.setCustomValidity(emptyOrSpaces ? "Please enter a message." : "");
  };

  if (message) {
    // keep validity up to date as they type (no error shown until submit)
    message.addEventListener("input", updateMessageValidity);
    updateMessageValidity();
  }

  if (form) {
    form.addEventListener("submit", (e) => {
      updateMessageValidity(); // ensure latest check
      const firstInvalid = form.querySelector(":invalid");
      if (firstInvalid) {
        e.preventDefault();
        form.classList.add("was-validated");
        if (firstInvalid.focus) firstInvalid.focus();
      }
    });
  }
</script>
